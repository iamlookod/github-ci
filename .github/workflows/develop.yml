name: Call a reusable workflow and use its outputs

on:
  workflow_dispatch:

jobs:
  generate_config:
    uses: ./.github/workflows/config.yml
    env:
      SERVICE_NAME: "$(echo ${{ github.repository }} | cut  -d '/' -f 2)"
      BRANCH: "$(echo ${{ github.ref }} | cut  -d '/' -f 3- | sed -e 's|/|-|g')"
    with:
      service_name: ${{ env.SERVICE_NAME }}
      branch: ${{ env.BRANCH }}

  build:
    runs-on: ubuntu-latest
    needs: generate_config
    steps:
      - run: |
          echo ${{ needs.generate_config.outputs.image_tag }}
          echo ${{ needs.generate_config.outputs.image_name }}
          echo ${{ needs.generate_config.outputs.image_repository }}
